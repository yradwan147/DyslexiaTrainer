// Maze Tracking Exercise Data
// 15 hand-crafted mazes with wall grids, player position, and object positions
// Uses PNG sprites from /assets/maze/

export interface MazeConfig {
  maze_id: number;
  grid_size: number;       // 19 or 25
  corridors: number;       // 9 or 12
  grid: string[];          // text grid lines (# = wall, . = path)
  player: { row: number; col: number };
  objects: { row: number; col: number; order: number }[];
  object_count: number;
}

// Image path helpers
export function getPlayerImagePath(): string {
  return '/assets/maze/player.png';
}

export function getObjectImagePath(mazeId: number): string {
  return `/assets/maze/${mazeId}.png`;
}

// Parse a text grid to extract player, objects, and clean wall grid.
// Also ensures an exit opening exists on the outer border.
function parseMaze(id: number, lines: string[]): MazeConfig {
  let player = { row: 0, col: 0 };
  const objects: { row: number; col: number; order: number }[] = [];
  const gridRows: string[][] = []; // mutable char grid
  let objectOrder = 1;

  for (let r = 0; r < lines.length; r++) {
    const row: string[] = [];
    for (let c = 0; c < lines[r].length; c++) {
      const ch = lines[r][c];
      if (ch === 'P') {
        player = { row: r, col: c };
        row.push('.');
      } else if (ch === 'O') {
        objects.push({ row: r, col: c, order: objectOrder++ });
        row.push('.');
      } else {
        row.push(ch);
      }
    }
    gridRows.push(row);
  }

  const gs = lines.length;
  const w = lines[0].length;

  // Ensure an entrance opening on the border next to the player
  ensureBorderOpening(gridRows, player.row, player.col, gs, w);

  // Ensure an exit opening on the border near the last object
  if (objects.length > 0) {
    const lastObj = objects[objects.length - 1];
    ensureBorderOpening(gridRows, lastObj.row, lastObj.col, gs, w);
  }

  const cleanGrid = gridRows.map(row => row.join(''));

  return {
    maze_id: id,
    grid_size: gs,
    corridors: (gs - 1) / 2,
    grid: cleanGrid,
    player,
    objects,
    object_count: objects.length,
  };
}

// Punch an opening in the nearest outer border wall for a given interior cell.
function ensureBorderOpening(grid: string[][], row: number, col: number, gs: number, w: number): void {
  // Find the closest border edge
  const distTop = row;
  const distBottom = gs - 1 - row;
  const distLeft = col;
  const distRight = w - 1 - col;
  const minDist = Math.min(distTop, distBottom, distLeft, distRight);

  if (minDist === distTop) {
    // Open path from row up to row 0
    for (let r = row - 1; r >= 0; r--) {
      if (grid[r][col] === '#') grid[r][col] = '.';
    }
  } else if (minDist === distBottom) {
    // Open path from row down to last row
    for (let r = row + 1; r < gs; r++) {
      if (grid[r][col] === '#') grid[r][col] = '.';
    }
  } else if (minDist === distLeft) {
    // Open path from col left to col 0
    for (let c = col - 1; c >= 0; c--) {
      if (grid[row][c] === '#') grid[row][c] = '.';
    }
  } else {
    // Open path from col right to last col
    for (let c = col + 1; c < w; c++) {
      if (grid[row][c] === '#') grid[row][c] = '.';
    }
  }
}

// All 15 mazes from reference images
export const MAZE_CONFIGS: MazeConfig[] = [
  // Maze 1: 9 corridors, 19x19, 5 chests
  parseMaze(1, [
    '###################',
    'P.......#....O....#',
    '###.#####.###.###.#',
    '#...........#...#.#',
    '#.#######.#####.#.#',
    '#...#.....#.....#.#',
    '###.#######.#####.#',
    '#.#...#.......#..O#',
    '#.#####.###.#.#.###',
    '#.....O...#.#.#...#',
    '#.#.#####.#.#.###.#',
    '#.#.#.....#.#...#.#',
    '###.#######.###.#.#',
    '#O........#.#...#.#',
    '#.#######.#######.#',
    '#...#...#.......#.#',
    '###.#.#.#######.###',
    '#.....#.......#..O#',
    '###################',
  ]),

  // Maze 2: 9 corridors, 19x19, 5 purple chests
  parseMaze(2, [
    '###################',
    'P.....#..O......#.#',
    '###.#.#...#####.#.#',
    '#...#...#.#...#...#',
    '#.#.#####.#.#######',
    '#.#.#.....#.....#.#',
    '###.#.#######.#.#.#',
    '#..O#.....#...#...#',
    '#.#.#####.#.#######',
    '#.......#.#.....#.#',
    '#.###.###.#.#.#.#.#',
    '#...#...#.#.#.#...#',
    '###.#.#.###...###.#',
    '#..O#.#....O#...#.#',
    '#.###.#########.#.#',
    '#...#...#...#.#.#.#',
    '###.#####.#.#.#.###',
    '#.........#...#..O#',
    '###################',
  ]),

  // Maze 3: 9 corridors, 19x19, 7 coins
  parseMaze(3, [
    '###################',
    '#..O..#...#.......#',
    '#####.#.#.###.###.#',
    'P.....#.#.#..O#...#',
    '###.###.#.#.#######',
    '#....O..#.#...#...#',
    '#.#.#####.###.#.#.#',
    '#.#.#...#.#...#.#.#',
    '#.#.#.###.#.###.###',
    '#.#...#..O..#...#.#',
    '#.###.#.#.###.###.#',
    '#O..#.#.#.....#...#',
    '#######.#######.#.#',
    '#.#.......#.....#.#',
    '#.#.#.#####.#.#####',
    '#...#.O.....#....O.',
    '#.#######.#########',
    '#.......#.........#',
    '###################',
  ]),

  // Maze 4: 9 corridors, 19x19, 7 frogs
  parseMaze(4, [
    '###################',
    'P..O....#...#...#.#',
    '###.###.#.#.#.#.#.#',
    '#.#...#..O....#.#.#',
    '#.#.#.#########.#.#',
    '#...#.#.......#...#',
    '#.###O#.#.#########',
    '#...#.#.#.#.....#.#',
    '###.#.#.#.#.#.#.#.#',
    '#.O.....#.#.#.#...#',
    '#...#.#####.#.###.#',
    '#.#.#...#...#.#...#',
    '#.#.#####.###.###.#',
    '#.#....O....#.O.#.#',
    '#.#####.###.#.#.###',
    '#O..#.......#.#...#',
    '###.#.#######.###.#',
    '#...#...........#.#',
    '###################',
  ]),

  // Maze 5: 9 corridors, 19x19, 7 diamonds
  parseMaze(5, [
    '###################',
    '#.....#.......O...#',
    '#.#####.#####.#.#.#',
    '#.....#...O.#...#.#',
    '#####.#.###.#######',
    '#...#.#.#.#...#...#',
    '#.###.#.#.#.#.#.#.#',
    '#....O..#.#.#.#.#.#',
    '###.#####.#.#.#.#.#',
    '#.#.#.....#.#...#.#',
    '#.#.#.#.###.#######',
    '#.#...#.#.......#.#',
    '#.#.#.#.#.#####.#.#',
    '#...#.O.#...O.#...#',
    '#####.#######.#####',
    'P.O.....O.#.#.....#',
    '#####.###.#.#######',
    '#.......#.........#',
    '###################',
  ]),

  // Maze 6: 12 corridors, 25x25, 8 sheep
  parseMaze(6, [
    '#########################',
    '#.....O.....#...........#',
    '#.#########.###.#########',
    '#.#.....O.....#.....O..P',
    '###.#####.#######.#######',
    '#.#.....#.O.......O.#...#',
    '#.#####.#.#########.#.#.#',
    '#.......#...#...#.#...#.#',
    '#.#######.#.#.#.#.#######',
    '#.#.......#.#.#...#...#.#',
    '###########.#.###.#.#.#.#',
    '#.#.......O...#.#...#.#.#',
    '#.#.########.##.#######.#',
    '#.#.#...#.......#...#...#',
    '#.#.#.#.#.#######.#.#.###',
    '#.#...#.#.........#.....#',
    '#.###.#.###############.#',
    '#...#.#...#.............#',
    '###.#.###.#.###########.#',
    '#...#...#...#.......#...#',
    '#.#####.#####.#####...#.#',
    '#O#...#.#.....#...#.O.#.#',
    '#.#.#.#.#.#####.#.#.#.#.#',
    '#...#.....#.....#...#.#.#',
    '#####################.###',
  ]),

  // Maze 7: 12 corridors, 25x25, 8 keys
  parseMaze(7, [
    '#########################',
    '#.......#...........#.O.#',
    '#########.###############',
    '#.#.........#.#...#.#.#.#',
    '###.#.###.#.###.#.#.#####',
    '#.#.O.#.#.#..#..#.#.#####',
    '#####.#.#########.#.#####',
    '#.....#.#.#...#...#.#####',
    '#######.#.#.#############',
    '#.#..O..#.#...O.....#####',
    '#####.###.#####.#.#.#####',
    '###.O.#.......#.#.#.#.#.#',
    '###.#.#.#..####.#.###.#.#',
    'P.O.#.#.#.#.#...#....#.#.',
    '#######.###.#####.#######',
    '#.#...#.#.O.#...#...#.#.#',
    '###.###.#######.###.#####',
    '#.#.#...#.....#.#.#.#.#.#',
    '###.#.#.#.#####.#.#.#####',
    '#.#.#.#.#.#.....#.#.#####',
    '###.#.#.#.#.#####.#.#####',
    '#O#...#...#.#.....#.#####',
    '###.#######.#######.#####',
    '#...........#......##.#.#',
    '#########################',
  ]),

  // Maze 8: 12 corridors, 25x25, 8 stars
  parseMaze(8, [
    '#########################',
    '#.......#.........O.#.#.#',
    '#########.#########.#####',
    '#.#.O.......#.#...#.#.#.#',
    '###.#.###.#.###.#.#.#####',
    '#.#.#.#.#.#..#..#.#.#####',
    '#####.#.#.#######.#.#####',
    '#.....#.#.#...#...#.#####',
    '#######.#.#.#############',
    '#.#..O..#.#...#...O.#####',
    '#####.###.#####.#.#.#####',
    '###...#.......#.#.#.#.#.#',
    '#.#.#.#.#..####.#.###.#.#',
    'P.O.#.#.#.#.#...#....#.#.',
    '#######.#.#.#####.#######',
    '#.#...#.#...#...#...#.#.#',
    '###.###.#######.###.#####',
    '#.#.#.O.#.....#.#.#.#.#.#',
    '###.#.#.#.#####.#.#.#####',
    '#.#.#.#.#.#.....#.#.#####',
    '###.#.#.#.#.#####.#.#####',
    '#O#...#...#.#.....#.#####',
    '###.#######.#######.#####',
    '#.#.........#..O....#.#.#',
    '#########################',
  ]),

  // Maze 9: 12 corridors, 25x25, 8 clouds
  parseMaze(9, [
    '#########################',
    '#O......#...O.......#.#.#',
    '#.#######.#########.#####',
    '#.#..O......#.#...#.#.#.#',
    '###.#.###.#.###.#.#.#####',
    '#.#.#.#.#.#..#..#.#.#####',
    '#####.#.#.#######.#.#####',
    '#.....#.#.#...#...#.#####',
    '#######.#.#.#############',
    '#.#.....#.#...#.....#####',
    '#####.###.#####.#.#.#####',
    '###...#.......#.#.#.#.#.#',
    '###.#.#.#..####.#.###.#.#',
    'P.O.#.#.#.#.#.O.#..O.#.#.',
    '#######.#.#.#####.#######',
    '#.#...#.#...#...#...#.#.#',
    '###.###.#######.###.#####',
    '#.#.#...#.....#.#.#.#.#.#',
    '###.#.#.#.#####.#.#.#####',
    '#.#.#.#.#.#.....#.#.#####',
    '###.#.#.#.#.#####.#.#####',
    '#.#...#...#.#.....#.#####',
    '###.#######.###.###.#####',
    '#.#..O......#..O....#.#.#',
    '#########################',
  ]),

  // Maze 10: 12 corridors, 25x25, 8 cars
  parseMaze(10, [
    '#########################',
    '#...........#...........#',
    '#.#########.###.#########',
    '#.#..O......#.......O...#',
    '###.#####.#######.#######',
    '#.#.....#.#.#.....#.#.O.#',
    '#.#####.#.#.#####.#.#.#.#',
    '#.......#...#...#.#...#.#',
    '#.#######.#.#.#.#.#######',
    '#.#.......#.#.#...#...#.#',
    '###########.#.###.#.#.#.#',
    '#.#..O........#.#...#.#.#',
    '#.#.########.##.#######.#',
    '#.#.#...#..O....#...#...#',
    '#.#.#.#.#.#######.#.#.###',
    '#.#...#.#.........#.....#',
    '#.###.#.###############.#',
    '#.O.#.#...#.............#',
    '###.#.###.#.###########.#',
    '#...#...#...#.......#...#',
    '#.#####.#####.#####...#.#',
    '#.#...#.#.....#...#.O.#.#',
    '#.#.#.#.#.#####.#.#.#.#.#',
    'P.O.#...........#...#.#.#',
    '#####################.###',
  ]),

  // Maze 11: 12 corridors, 25x25, 9 chickens
  parseMaze(11, [
    '#############P###########',
    '#.#...#.....#.#.........#',
    '#.#.#.#.###.#.#########.#',
    '#...#O..#...O.....#...#.#',
    '#####.###.#.#.#.#.##..#.#',
    '#...#.....#.#...#.....#.#',
    '#.#.#.#####.###.#######.#',
    '#.#...#.....#...#...#...#',
    '#.#####.#####.#####.#.###',
    '#.#.......O.#.....#.#..O#',
    '#.#.###.#.#.###.#.#.###.#',
    '#.#...#.#.#.....#...#.#.#',
    '#.#####.#.##.#####.##.#.#',
    '#...#...#...#.....O...#.#',
    '###.#.#####.#.####..#.#.#',
    '#.#.#.#.....#.#...#.#.#.#',
    '#.#.#..O#####.###.#.###.#',
    '#.#.#.O...........#.#...#',
    '#.################..#.###',
    '#O....#...#...#.....#...#',
    '#####.#.#.#.#.#.#######.#',
    '#.....#.#.#.#.....#...#.#',
    '#.#####.#.#.#.###.#.#.#.#',
    '#.......#.O...#.....#...#',
    '###########.#.###########',
  ]),

  // Maze 12: 12 corridors, 25x25, 9 monkeys
  parseMaze(12, [
    '#########################',
    '#.....O.....#...........#',
    '#.########..###.######.##',
    '#.#.....O.....#.......O.P',
    '###.#####.#######.####.##',
    '#.#.....#.O.........#...#',
    '#.O####.#.#########.#.#.#',
    '#.......#...#...#.#...#.#',
    '#..######.#.#.#.#.#######',
    '#.#.......#.#.#...#...#.#',
    '###########.#.##..#.#.#.#',
    '#.#...........#.#...#.#.#',
    '#.#.########.#..#######.#',
    '#.#.#...#..O....#...#...#',
    '#.#.#.#.#.#######.#.#.###',
    '#.#...#.#.........#.....#',
    '#.###.#.###############.#',
    '#...#.#...#.............#',
    '###.#..##.#.###########.#',
    '#...#.O.#...#.......#...#',
    '#.#####.#####.#####.#.#.#',
    '#.#...#.#.....#...#.O..#.',
    '#.#.#.#.#.#####.#.#..#.#',
    '#...#..O........#...#.#.#',
    '#########.###########.###',
  ]),

  // Maze 13: 12 corridors, 25x25, 9 wands
  parseMaze(13, [
    '#########################',
    '#...............#.......#',
    '#.#########.###.#.#####O#',
    '#...O.#....O..#...#...#.#',
    '#####.#.#####.#####.#.#.#',
    '#.....#.#...#.#.....#.#.#',
    '#.#####.#.###.#.#######.#',
    '#.......#.#...#...#...#.#',
    '#.#######.#.#.###.#.#.#.#',
    '#...#..O..#.#.....#.#.#.#',
    '#.#.#####.#.#######.#.#.#',
    '#.#.#.....#...#.....#.#.#',
    '###.#.#####...#.#####.###',
    'P.O...#.#...#.#.....#.O.#',
    '###.###.#.#####.###.#.###',
    '#.#.....#.#...#.O.#.#...#',
    '#.###.##..#.#.##..#.###.#',
    '#...#.#.O.#.#...#.#...#.#',
    '#.#.#.#.#.#.#####.#.###.#',
    '#.#...#.#...#.....#...#.#',
    '#.#####.#####.##.####.#.#',
    '#...O.#.......#...#...#.#',
    '#####.#########.#.#.###.#',
    '#...............#.#.....#',
    '#########################',
  ]),

  // Maze 14: 12 corridors, 25x25, 9 trees
  parseMaze(14, [
    '#########################',
    '#.O.....#..O..#.......#.#',
    'P####.#.#.###.#.######.##',
    '#.....#.....#...#...#.###',
    '###.#############.#######',
    '#..O........#.......#.###',
    '#.#####.###.#.#####.#####',
    '#.....#.#...#.#.O.#.#.###',
    '#####.#.#.###.#.#.#.#####',
    '#.....#.#...#...#.#.#.###',
    '#.#####.###.###.#.#.#####',
    '#.#.......#...#.#.#.#.#.#',
    '#.#.###.####.##.#.#.###.#',
    '#.#.#.#.#..O....#.#.#.#.#',
    '#.#.#.#.#.#######.#.#####',
    '#.#.#...#...#.....#.#.###',
    '###.#.#####.#.#####.#####',
    '#...#.#...#.#...#...#.###',
    '#.###.#.#.#.###.#.#######',
    '#.#..O..#.#...#.#..O.##.#',
    '#.#######.###.###########',
    '#O......#...#.#...#.#..#.',
    '#.#####.#####.#.#.#.#####',
    '#..O..#.........#.....#.#',
    '#########################',
  ]),

  // Maze 15: 12 corridors, 25x25, 9 moons
  parseMaze(15, [
    '#########################',
    '#.......#...#.#...#...#.#',
    '#####.#.#.#O..#.#.#.#.#.#',
    'P..O..#...#...#.#...#...#',
    '###.###########.#########',
    '#.......#..O..#.......#.#',
    '#.#.###.#####.#.###.#.#.#',
    '#.#...#.#.....#.#.#.#...#',
    '###.###.#.#####.#.#.###.#',
    '#...#..O#.....#.#..O..#.#',
    '#.###.#######.#.###.#.#.#',
    '#...#.#.#.....#.#...#.#.#',
    '###.#.#.#.##.##.#####.###',
    '#...#.#.........#...#....',
    '#.###.#.#.#######.#.#####',
    '#.#.O.#.#.#.......#.....#',
    '#.#.#.###.#.#############',
    '#.#.#...#.O...#...#.....#',
    '###.###.###.#.#.#.#.###.#',
    '#.#.#.....#.#...#O..#...#',
    '#O#.#######.#########.###',
    '............#...#...#...#',
    '#.#.#########.#.#...###.#',
    '#.#...........#...#.#...#',
    '#########################',
  ]),
];

// Get maze config by level (1-15)
export function getMazeConfig(level: number): MazeConfig {
  const idx = Math.max(0, Math.min(14, level - 1));
  return MAZE_CONFIGS[idx];
}
